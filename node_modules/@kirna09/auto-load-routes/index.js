// index.js (El componente que subirás a NPM)

const express = require('express');
const fs = require('fs');
const path = require('path');

/**
 * Función que carga automáticamente todos los archivos de rutas de una carpeta dada.
 * @param {string} routesPath - La ruta absoluta de la carpeta que contiene los archivos de ruta.
 * @returns {express.Router} Un router principal que contiene todas las sub-rutas montadas.
 */
function autoLoadRoutes(routesPath) {
    const mainRouter = express.Router();
    
    // Asegúrate de que la ruta exista
    if (!fs.existsSync(routesPath)) {
        console.error(`ERROR: La carpeta de rutas no existe: ${routesPath}`);
        return mainRouter;
    }

    const removeExtension = (fileName) => path.parse(fileName).name;

    // 1. Leer todos los archivos de la carpeta
    fs.readdirSync(routesPath).forEach((file) => {
        const fileName = removeExtension(file);

        // 2. Filtrar el archivo 'index' y asegurar que sea un archivo .js
        if (fileName !== 'index' && file.endsWith('.js')) {
            try {
                // 3. Importar el router del archivo
                const routeModule = require(path.join(routesPath, file));
                
                // 4. Definir el prefijo de la ruta (Ej: /condominios)
                const routePrefix = `/${fileName}`; 

                // 5. Montar el router
                mainRouter.use(routePrefix, routeModule);

                console.log(`[AutoLoadRoutes] ✅ Montada: ${routePrefix}`);
                
            } catch (error) {
                console.error(`[AutoLoadRoutes] ❌ Error al cargar ${file}:`, error.message);
            }
        }
    });

    return mainRouter;
}

// Exportar la función para que sea el punto de entrada de tu paquete
module.exports = autoLoadRoutes;